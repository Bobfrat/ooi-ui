{% extends "common/base.html" %}

{% block title %}
    <title>Triggered Alerts</title>
{% endblock %}

{% block head %}
  <link rel="stylesheet" href="/css/compiled/index.css" type="text/css" />

  <script src="/js/partials/compiled/alertPage.js" type="text/javascript"></script>
  <script src="/js/compiled/alertPage.js" type="text/javascript"></script>

  <script src="/lib/backgrid/lib/backgrid.js" type="text/javascript"></script>
  <script src="/lib/backbone-pageable/lib/backbone-pageable.min.js" type="text/javascript"></script>
  <script src="/js/core/backgrid/backgrid-paginator.min.js" type="text/javascript"></script>
  <script src="/js/core/backgrid/backgrid-select-all.min.js" type="text/javascript"></script>
  <script src="/js/core/backgrid/backgrid-filter.min.js" type="text/javascript"></script> 
<!--
  <script src="/js/views/aa/TriggeredView.js" type="text/javascript"></script>
    -->
{% endblock %}

{% block body %}
  <div class="container-fluid">
  <div id="navbar" class="row"></div>
</div>

<div id="wrapper">
  <!-- Sidebar -->
  <div id="sidebar-wrapper">
  </div>
   
   <div id="page-content-wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <div id="aa-trig-panel" class="panel">
            <!--
            <div class="panel-heading"><div>
              <h4 style='margin-top: 0px;margin-bottom: -25px;'> Triggered Alerts & Alarms</h4>
              -->
            <div id="aatrig-panel-body" class="panel-body">
              <div style='color:#337ab7; text-transform:none; position: absolute;margin-left: -2px;' id='triggeredAA'>
                <b>Showing All Triggered Alerts and Alarms</b>
               </div>
               <div id='triggerlist' class="row form-group">
              </div>
              <hr width ='80%' style='margin-top:0;'>
              <div class="form-group">
              <div align="center">
                <div>
                  <div class="col-sm-12" id="loading_triggers" style='font-weight:bold;padding-top:35px;'>
                    <i style="color:#337ab7" class="fa fa-spinner fa-spin"></i>  Loading Triggered Alerts and Alarms 
                  </div>
                  <!--<button type="button" id="saveAlert" class="btn btn-primary">Save Alert</button> 
                  <button type="button" id="saveAlarm" class="btn btn-primary"><i class="fa fa-floppy-o"></i> Save Changes</button>-->
                  <button type="button" id="resetTriggers" class="btn btn-primary"><i class="fa fa-list"></i> Show all Triggered Alerts and Alarms</button>
                </div>
              </div>
             </div>  
            </div> 
            </div> 
          </div> 
        </div> 
      </div>
    </div>
  </div>
</div>
<!-- Menu Toggle Script -->
<script type="text/javascript">

var bannerTitle = "Triggered Alerts & Alarms";

_.extend(OOI.prototype, Backbone.Events, {
  login: new LoginModel(),
  models: {
    mapModel: new MapModel(),
    alertModel: new TriggeredModel(),
    userModel: new UserModel()  
  },

  collections: {
    arrays: new ArrayCollection(),
    triggered_alerts_list: new TriggeredFullCollection(),
    toc: new TocCollection()
  },
  views: {
      //
  },
  start: function() {
    var self = this;

    this.login.fetch({async: false}); // Doesn't actually make an ajax request
    if(this.login.loggedIn()) {
        this.models.userModel.fetch({url: '/api/current_user'});      
    }

    //--------------------------------------------------------------------------------
    // Views
    //--------------------------------------------------------------------------------
    this.views.banner = new BannerView({bannerTitle});
    $('body').prepend(this.views.banner.el);

    this.views.navbar = new NavbarView({
        el: $('#navbar')
    });

    this.views.tocView = new TOCView({

      arrayCollection: this.collections.arrays,
      collection: this.collections.toc,
      el: $('#sidebar-wrapper')
    });

    $('#sidebar-wrapper').html(this.views.tocView.el);

    $('.navbar-brand').html('Triggered Alerts & Alarms Dashboard');

    $('#navbar-menus').append('<li id="Science"><a href="/alerts/dashboard">Alerts Dashboard</a></li>');

    //--------------------------------------------------------------------------------
    // Collections Fetch
    //--------------------------------------------------------------------------------
    
    //empty table
    $('#alert_table tbody').empty();

    var tocFetch = this.collections.toc.fetch({reset: true});
    var arraysFetch = this.collections.arrays.fetch({reset: true});
    
    $.when(tocFetch,arraysFetch).done(function(){
      self.views.tocView.collection = self.collections.toc;
      self.views.tocView.arrayCollection = self.collections.arrays;
      self.views.tocView.render();
    });

    this.views.triggeredView = new TriggeredView({
        //el: 'form',
        collection: this.collections.triggered_alerts_list
    }); 

    this.listenTo(this, "login:success", this.onLogin);
    this.listenTo(this, "login:logout", this.onLogout);
   }
});
var ooi = new OOI();

$(document).ready(function() {
    $("body").tooltip({ selector: '[data-toggle=tooltip]' });
    ooi.start();
});
</script>
{% endblock %}
