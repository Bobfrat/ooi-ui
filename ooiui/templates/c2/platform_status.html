{% extends "common/base.html" %}

{% block title %}
<title>Command & Control: Platform Status</title>
{% endblock %}

{% block beforebootstrap %}

{% endblock %}

{% block head %}
<link rel="stylesheet" href="/css/compiled/index.css" type="text/css" />
<link rel="stylesheet" href="/css/compiled/basic.css" type="text/css" />
<link rel="stylesheet" href="/css/common/timeline.css" type="text/css" />
<link rel="stylesheet" href="/css/compiled/c2.css" type="text/css" />
<!-- Partials -->
<script src="/js/partials/compiled/c2.js" type="text/javascript"></script>
<script src="/js/compiled/c2.js" type="text/javascript"></script>

<style></style>
{% endblock %}

{%block body %}
<div id="wrapper">
  <div id="sidebar-wrapper" class="navbar-default">
  </div>

  <div id="page-content-wrapper">
    <div class="container-fluid">
        <div class="row">
          <div class="pull-left col-lg-8">
          <div id="array_list" class="btn-group">
{#            <div class="btn-group" id='array_list' role="group" style="top: -7px;" aria-label="...">#}
{#            </div>#}
          </div>
        </div>
        </div>
        <div class="row">
            <div id="platform-dashboard" class="col-lg-4">
            ADD PLATFORM STATUS HERE
            </div>
            <div id="instrument-dashboard" class="col-lg-4">
            ADD INSTRUMENT STATUS HERE
            </div>
        </div>
    </div>
  </div>
</div>

<script type="text/javascript">
/*
 * OOI is the main class that we extend from to create behavior and render pages.
 *
 * Here we create the application by extending OOI with Backbone.Events, this
 * gives us the ability to listen to events from models and/or views. When we
 * hear these events the main application can then trigger another view to
 * render, or in this case cause a collection to be fetched as a result.
 */
_.extend(OOI.prototype, Backbone.Events,  {
  login: new LoginModel(),
  // Models and collections
  collections: {
    arrayNavCollection: new ArrayNavCollection(),
    platformStatusCollection: new PlatformStatusCollection()
  },
  models: {
    arrayNavModel: new ArrayNavModel(),
    platformStatusModel: new PlatformStatusModel(),
    userModel: new UserModel()
  },
  views: {
  },
  start: function() {
    this.login.fetch({async:false});
    this.collections.platformStatusCollection.fetch('CP');
    this.views.navbar = new NavbarView();
    $('body').prepend(this.views.navbar.el);

    if(this.login.loggedIn()) {
      this.models.userModel.fetch({url: '/api/current_user'});
    }
    this.collections.arrays = new ArrayNavCollection();
    this.collections.arrays.fetch({reset: true});
    this.views.arrayNavView = new ArrayNavView({
       collection: this.collections.arrays
    });
    $('#array_list').html(this.views.arrayNavView.el);

    this.views.platformStatusView = new PlatformStatusView({
      collection: this.collections.platformStatusCollection
    });
    $('#sidebar-wrapper').html(this.views.platformStatusView.el);

    this.eventListeners();
  },
  eventListeners:function() {
    this.listenTo(this, "arraynav:click", this.onArrayNavClick);
    this.listenTo(this, "platformnav:click", this.onPlatformNavClick);
    this.listenTo(this, "login:success", this.onLogin);
    this.listenTo(this, "login:logout", this.onLogout);
  },
  onArrayNavClick: function(refdes) {
    console.log('array clicked: ' + refdes);
    this.collections.platformStatusCollection.fetch(refdes);
  },
  onPlatformNavClick: function(refdes) {
    console.log('platform clicked' + refdes);
  },
  onLogin: function() {
    location.reload();
  },
  onLogout: function() {
    location.reload();
  }
});
// Instantiate the application for this page
var ooi = new OOI();

$(document).ready(function() {
  // Once the DOM is loaded, we start our application
  ooi.start();
});


</script>

{% endblock %}
